CREATE OR REPLACE TRIGGER szerelveny_h_trg
  AFTER INSERT OR UPDATE OR DELETE ON szerelveny
  FOR EACH ROW
DECLARE
  v_mod_user szerelveny.mod_user%TYPE;
  v_mod_time szerelveny.last_mod%TYPE;
BEGIN
  v_mod_user := sys_context('USERENV', 'OS_USER');
  v_mod_time := SYSDATE;

  IF deleting
  THEN
    insert into szerelveny_h(szerelveny_id,
                             vontato_rendszam,
                             utanfuto_rendszam,
                             szallitott_autok,
                             last_mod,
                             created,
                             mod_user,
                             dml_flag,
                             version)
    values(
    :old.szerelveny_id
    ,:old.vontato_rendszam
    ,:old.utanfuto_rendszam
    ,:old.szallitott_autok
    ,v_mod_time
    ,:old.created
    ,v_mod_user
    ,'D'
    ,:old.version + 1);
    
  ELSE
    insert into szerelveny_h(szerelveny_id,
                             vontato_rendszam,
                             utanfuto_rendszam,
                             szallitott_autok,
                             last_mod,
                             created,
                             mod_user,
                             dml_flag,
                             version)
         
    values(
    :new.szerelveny_id
    ,:new.vontato_rendszam
    ,:new.utanfuto_rendszam
    ,:new.szallitott_autok
    ,:new.last_mod
    ,:new.created
    ,:new.mod_user
    ,:new.dml_flag
    ,'D'
    ,:new.version);
    
     
    
  END IF;
END szerelveny_h_trg;
/
